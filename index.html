'use client';

import { useState } from 'react';
import styles from './page.module.css';

// 1. Define the Data
const PROVIDERS = [
  {
    id: 1,
    name: "Rosewood Independent Care",
    location: "0.8 miles away • Corringham",
    price: 1850,
    score: 98,
    tags: ["Private Chapel", "24/7 Collection", "Eco-Options"],
    reviews: "⭐⭐⭐⭐⭐ (124 reviews)",
    owner: "Family Owned",
    chapel: "Yes",
    collection: "24/7 Included",
    isSponsored: true
  },
  {
    id: 2,
    name: "City Memorial Services",
    location: "2.4 miles away • Stanford-le-Hope",
    price: 2200,
    score: 62,
    tags: ["Corporate Group", "Modern Facilities"],
    reviews: "⭐⭐⭐⭐ (32 reviews)",
    owner: "Corporate Group",
    chapel: "Yes",
    collection: "Additional Fee",
    isSponsored: false
  }
];

export default function FuneralComparisonPage() {
  // 2. State Management
  const [compareList, setCompareList] = useState<number[]>([]);
  const [isModalOpen, setIsModalOpen] = useState(false);

  // 3. Handlers
  const toggleCompare = (id: number) => {
    if (compareList.includes(id)) {
      setCompareList(prev => prev.filter(pId => pId !== id));
    } else {
      if (compareList.length >= 3) {
        alert("You can only select up to 3 providers.");
        return;
      }
      setCompareList(prev => [...prev, id]);
    }
  };

  const clearCompare = () => {
    setCompareList([]);
  };

  const selectedProviders = PROVIDERS.filter(p => compareList.includes(p.id));

  return (
    <div style={{ background: '#f4f7f6', minHeight: '100vh' }}>
      {/* HEADER */}
      <header className={styles.header}>
        <div className={styles.logo}>TRANSPARENCY</div>
        <nav>
          <a href="#" className={styles.fdLogin}>Director Login</a>
        </nav>
      </header>

      <div className={styles.container}>
        {/* FILTERS SIDEBAR */}
        <aside className={styles.filters}>
          <div className={styles.filterBox}>
            <div className={styles.filterGroup}>
              <h4>Service Type</h4>
              <label className={styles.label}><input type="checkbox" defaultChecked /> Direct Cremation</label>
              <label className={styles.label}><input type="checkbox" /> Traditional Burial</label>
              <label className={styles.label}><input type="checkbox" /> Eco-Funeral</label>
            </div>
            <div className={styles.filterGroup}>
              <h4>Ownership</h4>
              <label className={styles.label}><input type="checkbox" /> Family Owned</label>
              <label className={styles.label}><input type="checkbox" /> Large Corporate</label>
            </div>
          </div>
        </aside>

        {/* RESULTS FEED */}
        <main className={styles.results}>
          {PROVIDERS.map((provider) => (
            <div 
              key={provider.id} 
              className={`${styles.card} ${provider.isSponsored ? styles.sponsored : ''}`}
            >
              <div>
                <span className={`${styles.scorePill} ${provider.score > 80 ? styles.highScore : styles.medScore}`}>
                  {provider.score}% Transparency Score
                </span>
                <h2 style={{ margin: 0 }}>{provider.name}</h2>
                <p style={{ color: '#666', margin: '5px 0' }}>{provider.location}</p>
                <div style={{ margin: '15px 0' }}>
                  {provider.tags.map(tag => (
                    <span key={tag} className={styles.tag}>{tag}</span>
                  ))}
                </div>
                <p style={{ fontSize: '0.85rem' }}>{provider.reviews}</p>
              </div>

              <div style={{ textAlign: 'right', borderLeft: '1px solid #eee', paddingLeft: '20px' }}>
                <div style={{ fontSize: '0.8rem', color: '#888' }}>Total Estimated Cost</div>
                <div className={styles.priceTag}>£{provider.price.toLocaleString()}</div>
                <button className={styles.btnBook}>Book Now</button>
                <button 
                  className={`${styles.btnCompare} ${compareList.includes(provider.id) ? styles.btnCompareActive : ''}`}
                  onClick={() => toggleCompare(provider.id)}
                >
                  {compareList.includes(provider.id) ? "✓ Selected" : "+ Compare"}
                </button>
              </div>
            </div>
          ))}
        </main>
      </div>

      {/* COMPARISON BAR (Fixed Bottom) */}
      {compareList.length > 0 && (
        <div className={styles.compareBar}>
          <div>{compareList.length} provider(s) selected</div>
          <div>
            <button className={styles.clearBtn} onClick={clearCompare}>Clear All</button>
            <button className={styles.compareActionBtn} onClick={() => setIsModalOpen(true)}>
              Compare Details Now
            </button>
          </div>
        </div>
      )}

      {/* COMPARISON MODAL */}
      {isModalOpen && (
        <div className={styles.modalOverlay} onClick={() => setIsModalOpen(false)}>
          <div className={styles.modalContent} onClick={e => e.stopPropagation()}>
            <span className={styles.closeModal} onClick={() => setIsModalOpen(false)}>&times;</span>
            <h2 style={{ marginTop: 0 }}>Provider Comparison</h2>
            
            <table className={styles.table}>
              <tbody>
                <tr>
                  <th>Feature</th>
                  {selectedProviders.map(p => <th key={p.id}>{p.name}</th>)}
                </tr>
                <tr>
                  <td>Est. Total Price</td>
                  {selectedProviders.map(p => <td key={p.id}><strong>£{p.price.toLocaleString()}</strong></td>)}
                </tr>
                <tr>
                  <td>Transparency Score</td>
                  {selectedProviders.map(p => <td key={p.id}>{p.score}%</td>)}
                </tr>
                <tr>
                  <td>Ownership</td>
                  {selectedProviders.map(p => <td key={p.id}>{p.owner}</td>)}
                </tr>
                <tr>
                  <td>Private Chapel</td>
                  {selectedProviders.map(p => <td key={p.id}>{p.chapel}</td>)}
                </tr>
                <tr>
                  <td>Collection</td>
                  {selectedProviders.map(p => <td key={p.id}>{p.collection}</td>)}
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
}
